=== modified file 'ChangeLog'
--- ChangeLog	2009-06-17 18:00:49 +0000
+++ ChangeLog	2009-06-18 19:06:10 +0000
@@ -1,5 +1,39 @@
+2009-06-18  Scott James Remnant  <scott@netsplit.com>
+
+	* compat/sysv/telinit.c: We have no UPSTART_INIT_DAEMON #define here
+
+	* util/initctl.c (log_priority_action): Restore code to check for
+	no argument.
+
+	* NEWS: Update.
+
+	* util/initctl.c (status_action): Don't call fnmatch() until we have
+	the job name.
+
+	* util/shutdown.c (shutdown_now): $INIT_HALT must not be the first
+	argument, scripts will expect $RUNLEVEL to be the first.
+
+	* compat/sysv/telinit.c: Send the init daemon SIGTERM when given
+	  the "u" argument.  This remains undocumented and may be withdrawn
+	  in future versions.
+
+2009-06-18  Casey Dahlin  <cdahlin@redhat.com>
+
+	* util/man/initctl.8: Fix formatting of SYNOPSIS
+
+2009-06-18  Scott James Remnant  <scott@netsplit.com>
+
+	* dbus/com.ubuntu.Upstart.xml, dbus/com.ubuntu.Upstart.Job.xml,
+	dbus/com.ubuntu.Upstart.Instance.xml: Add a comment to these files
+	to clarify that you may communicate and interact with Upstart
+	through these interfaces without restriction.  It also makes sense
+	that these files be copied into software that does so to turn into
+	their own bindings, so use the FSF permissive licence for them.
+
 2009-06-17  Scott James Remnant  <scott@netsplit.com>
 
+	* configure.ac: Bump version to 0.5.3
+
 	* NEWS: Release 0.5.2
 
 	* util/Makefile.am (nodist_test_initctl_SOURCES): Also include instance

=== modified file 'NEWS'
--- NEWS	2009-06-17 18:00:49 +0000
+++ NEWS	2009-06-18 18:09:25 +0000
@@ -1,3 +1,20 @@
+0.5.3  xxxx-xx-xx
+
+	* Fixed segfault when initctl status called with arguments.
+	  (Bug: #388753)
+
+	* Fixed segfault when initctl log-priority called with no argument.
+	  (Bug: #280529)
+
+	* Fixed shutdown to pass $INIT_HALT variable as last argument, not
+	  as first.  (Bug: #303574)
+
+	* Added temporary support for "telinit u" until we have true re-exec
+	  support.  This will be replaced by an initctl command in future.
+	  (Bug: #388742)
+
+	* Corrected formatting of initctl(8) manpage.  (Bug: #388745)
+
 0.5.2  2009-06-17  "Something, something, something, D-Bus"
 
 	* The licence for Upstart has been updated to GNU GPL v3.

=== modified file 'configure.ac'
--- configure.ac	2009-06-17 16:55:16 +0000
+++ configure.ac	2009-06-18 18:09:25 +0000
@@ -1,7 +1,7 @@
 # Process this file with autoconf to produce a configure script.
 
 AC_PREREQ(2.61)
-AC_INIT([upstart], [0.5.2], [upstart-devel@lists.ubuntu.com])
+AC_INIT([upstart], [0.5.3], [upstart-devel@lists.ubuntu.com])
 AC_COPYRIGHT([[Copyright © 2009 Canonical Ltd.]])
 AC_CONFIG_SRCDIR([init/main.c])
 AC_CONFIG_MACRO_DIR([m4])

=== modified file 'dbus/com.ubuntu.Upstart.Instance.xml'
--- dbus/com.ubuntu.Upstart.Instance.xml	2009-06-17 16:49:58 +0000
+++ dbus/com.ubuntu.Upstart.Instance.xml	2009-06-18 18:09:25 +0000
@@ -1,4 +1,20 @@
 <?xml version="1.0" encoding="UTF-8" ?>
+<!-- upstart
+
+     com.ubuntu.Upstart.Instance.xml - interface definition for interface
+     objects
+
+     Copyright © 2009 Canonical Ltd.
+     Author: Scott James Remnant <scott@netsplit.com>.
+
+     This file is free software; Canonical Ltd gives unlimited permission
+     to copy and/or distribute it, with or without modifications, as long
+     as this notice is preserved.
+
+     Communication and interaction with Upstart through this interface is
+     permitted without restriction.
+  -->
+
 <!DOCTYPE node PUBLIC
   "-//freedesktop//DTD D-BUS Object Introspection 1.0//EN"
   "http://www.freedesktop.org/standards/dbus/1.0/introspect.dtd">

=== modified file 'dbus/com.ubuntu.Upstart.Job.xml'
--- dbus/com.ubuntu.Upstart.Job.xml	2009-06-17 16:41:09 +0000
+++ dbus/com.ubuntu.Upstart.Job.xml	2009-06-18 18:09:25 +0000
@@ -1,4 +1,19 @@
 <?xml version="1.0" encoding="UTF-8" ?>
+<!-- upstart
+
+     com.ubuntu.Upstart.Job.xml - interface definition for job objects
+
+     Copyright © 2009 Canonical Ltd.
+     Author: Scott James Remnant <scott@netsplit.com>.
+
+     This file is free software; Canonical Ltd gives unlimited permission
+     to copy and/or distribute it, with or without modifications, as long
+     as this notice is preserved.
+
+     Communication and interaction with Upstart through this interface is
+     permitted without restriction.
+  -->
+
 <!DOCTYPE node PUBLIC
   "-//freedesktop//DTD D-BUS Object Introspection 1.0//EN"
   "http://www.freedesktop.org/standards/dbus/1.0/introspect.dtd">

=== modified file 'dbus/com.ubuntu.Upstart.xml'
--- dbus/com.ubuntu.Upstart.xml	2009-06-17 14:06:26 +0000
+++ dbus/com.ubuntu.Upstart.xml	2009-06-18 18:09:25 +0000
@@ -1,4 +1,19 @@
 <?xml version="1.0" encoding="UTF-8" ?>
+<!-- upstart
+
+     com.ubuntu.Upstart.xml - interface definition for manager object
+
+     Copyright © 2009 Canonical Ltd.
+     Author: Scott James Remnant <scott@netsplit.com>.
+
+     This file is free software; Canonical Ltd gives unlimited permission
+     to copy and/or distribute it, with or without modifications, as long
+     as this notice is preserved.
+
+     Communication and interaction with Upstart through this interface is
+     permitted without restriction.
+  -->
+
 <!DOCTYPE node PUBLIC
   "-//freedesktop//DTD D-BUS Object Introspection 1.0//EN"
   "http://www.freedesktop.org/standards/dbus/1.0/introspect.dtd">

=== modified file 'util/initctl.c'
--- util/initctl.c	2009-06-17 17:15:10 +0000
+++ util/initctl.c	2009-06-18 18:09:25 +0000
@@ -311,15 +311,15 @@
 		nih_local char *instname = NULL;
 		int inst_count = 0;
 
-		if (args[0] && fnmatch (args[0], name, 0))
-			continue;
-
 		job = NIH_MUST (nih_dbus_proxy_new (NULL, conn,
 						    proxy->name, *jobs,
 						    NULL, NULL));
 
 		NIH_ZERO (job_class_get_name_sync (NULL, job, &name));
 
+		if (args[0] && fnmatch (args[0], name, 0))
+			continue;
+
 		if (job_class_get_all_instances_sync (NULL, job, &instances)) {
 			NihError *err;
 
@@ -512,6 +512,12 @@
 {
 	int priority;
 
+	if (! args[0]) {
+		fprintf (stderr, _("%s: missing priority\n"), program_name);
+		nih_main_suggest_help ();
+		return 1;
+	}
+
 	if (! strcmp (args[0], "debug")) {
 		priority = NIH_LOG_DEBUG;
 	} else if (! strcmp (args[0], "info")) {

=== modified file 'util/man/initctl.8'
--- util/man/initctl.8	2007-03-11 19:01:57 +0000
+++ util/man/initctl.8	2009-06-18 18:09:25 +0000
@@ -4,7 +4,7 @@
 initctl \- init daemon control utility
 .\"
 .SH SYNOPSIS
-\fBinitctl\fR [\fIOPTION\fR]... \fICOMMAND\fR [\fIOPTION\fR]... \fIARG...\fR
+\fBinitctl\fR [\fIOPTION\fR]... \fICOMMAND\fR [\fIOPTION\fR]... \fIARG\fR...
 .\"
 .SH DESCRIPTION
 .B initctl

=== modified file 'util/shutdown.c'
--- util/shutdown.c	2009-06-17 14:28:52 +0000
+++ util/shutdown.c	2009-06-18 18:09:25 +0000
@@ -493,16 +493,16 @@
 
 	env = NIH_MUST (nih_str_array_new (NULL));
 
+	e = NIH_MUST (nih_sprintf (NULL, "RUNLEVEL=%s", runlevel));
+	NIH_MUST (nih_str_array_addp (&env, NULL, NULL, e));
+	e = NIH_MUST (nih_sprintf (NULL, "PREVLEVEL=%s", prev_level()));
+	NIH_MUST (nih_str_array_addp (&env, NULL, NULL, e));
+
 	if (init_halt) {
 		e = NIH_MUST (nih_sprintf (NULL, "INIT_HALT=%s", init_halt));
 		NIH_MUST (nih_str_array_addp (&env, NULL, NULL, e));
 	}
 
-	e = NIH_MUST (nih_sprintf (NULL, "RUNLEVEL=%s", runlevel));
-	NIH_MUST (nih_str_array_addp (&env, NULL, NULL, e));
-	e = NIH_MUST (nih_sprintf (NULL, "PREVLEVEL=%s", prev_level()));
-	NIH_MUST (nih_str_array_addp (&env, NULL, NULL, e));
-	
 	/* Send the message */
 	if (control_emit_event_sync (NULL, proxy, "runlevel", env)) {
 		NihError *err;

=== modified file 'util/telinit.c'
--- util/telinit.c	2009-06-17 14:28:52 +0000
+++ util/telinit.c	2009-06-18 19:06:10 +0000
@@ -113,6 +113,9 @@
 	case 's':
 		args[0][0] = 'S';
 		break;
+	case 'u':
+		kill (1, SIGTERM);
+		exit (0);
 	default:
 		/* Ignore other arguments */
 		exit (0);

